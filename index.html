<!DOCTYPE html>
<html>
<head>
  <title>Painel Agenda</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    select, button { margin: 10px 0; padding: 8px; font-size: 16px; }
  </style>
</head>
<body>
  <h2>📅 Agende com um Barbeiro</h2>

  <select id="mes"></select>
  <select id="dia"></select>
  <select id="barbeiro"></select>

  <button onclick="consultarAgenda()">Ver horários</button>

  <pre id="resultado"></pre>

  <script>
    const barbeiroSelect = document.getElementById('barbeiro');
    const mesSelect = document.getElementById('mes');
    const diaSelect = document.getElementById('dia');
    const resultado = document.getElementById('resultado');

    // Carregar meses
    for (let i = 1; i <= 12; i++) {
      const opt = document.createElement('option');
      opt.value = i.toString().padStart(2, '0');
      opt.text = `${i} - ${new Date(0, i - 1).toLocaleString('pt-BR', { month: 'long' })}`;
      mesSelect.appendChild(opt);
    }

    // Carregar dias
    for (let i = 1; i <= 31; i++) {
      const opt = document.createElement('option');
      opt.value = i.toString().padStart(2, '0');
      opt.text = i;
      diaSelect.appendChild(opt);
    }

    // Carregar barbeiros via JSON
    fetch('http://ice-club.my/barbeiros.json')
      .then(res => res.json())
      .then(data => {
        data.forEach(nome => {
          const opt = document.createElement('option');
          opt.value = nome;
          opt.text = nome.charAt(0).toUpperCase() + nome.slice(1);
          barbeiroSelect.appendChild(opt);
        });
      });

    function consultarAgenda() {
      const mes = mesSelect.value;
      const dia = diaSelect.value;
      const barbeiro = barbeiroSelect.value;
      const hoje = new Date();
      const ano = hoje.getFullYear();
      const data = `${ano}-${mes}-${dia}`;

      fetch(`http://ice-club.my/get_agenda.php?barbeiro=${barbeiro}&data=${data}`)
        .then(res => res.json())
        .then(json => {
          if (json.erro) {
            resultado.textContent = `❌ Erro: ${json.erro}`;
          } else if (json.horarios.length === 0) {
            resultado.textContent = `⚠️ Nenhum horário disponível para ${json.data}`;
          } else {
            resultado.textContent = `📅 Horários para ${json.barbeiro} em ${json.data}:\n\n` + json.horarios.join('\n');
          }
        })
        .catch(err => resultado.textContent = 'Erro ao consultar horários.');
    }
  </script>
</body>
</html>
